@page
@model CourseFlow.Pages.Courses.IndexModel
@{
    ViewData["Title"] = "Course Management";
}

<style>
    .inactive-row {
        opacity: 0.5;
        filter: grayscale(100%);
    }

    .table-hover tbody tr:hover {
        background-color: #f8f9fa;
    }
</style>

<div class="d-flex justify-content-between align-items-center mb-3">
    <h2>Course Management</h2>

    <div class="d-flex gap-2">
        @if (User.IsInRole("ADMIN"))
        {
            <button class="btn btn-success bg-success-subtle text-success border-success"
                    data-bs-toggle="modal"
                    data-bs-target="#pendingModal">
                Pending (@Model.PendingCount)
            </button>
        }


        @if (User.IsInRole("ADMIN") || User.IsInRole("STAFF"))
        {
            <button class="btn btn-primary"
                    data-bs-toggle="modal"
                    data-bs-target="#addModal">
                + Add Course
            </button>
        }
        
    </div>
</div>

@if (TempData["SuccessMessage"] != null)
{
    <script>
        document.addEventListener("DOMContentLoaded", function () {

            const toastEl = document.getElementById("successToast");
            if (!toastEl) return;

            const toast = new bootstrap.Toast(toastEl, { delay: 3000 });
            toast.show();

        });
    </script>
}

@if (TempData["ErrorMessage"] != null)
{
    <script>
        document.addEventListener("DOMContentLoaded", function () {

            const toastEl = document.getElementById("errorToast");
            if (!toastEl) return;

            new bootstrap.Toast(toastEl, { delay: 5000 }).show();

        });
    </script>
}





<!-- SEARCH -->
<form method="get" class="row g-2 mb-3">
    <div class="col-md-4">
        <input class="form-control"
               name="search"
               value="@Model.Search"
               placeholder="Search course code / name" />
    </div>
    @if(User.IsInRole("ADMIN,STAFF"))
    {
        <div class="col-md-3">
            <select class="form-select" name="status">
                <option value="">All</option>
                <option value="active" selected="@(Model.Status=="active")">Active</option>
                <option value="inactive" selected="@(Model.Status=="inactive")">Inactive</option>
            </select>
        </div>
    }
    

    <div class="col-md-2">
        <button class="btn btn-primary w-100">Search</button>
    </div>
</form>

<table class="table table-bordered table-hover align-middle">
    <thead class="table-light">
        <tr>
            <th>Code</th>
            <th>Course</th>
            <th>Schedule</th>
            <th>Lecturer</th>
            <th style="width:280px;">Actions</th>
        </tr>
    </thead>

    <tbody>
    @foreach (var c in Model.Courses)
    {
        <tr class="@(c.IsActive ? "" : "inactive-row")">

            <!-- CODE -->
            <td class="fw-semibold">
                @c.CourseCode
            </td>

            <!-- COURSE NAME -->
            <td>
                <div class="fw-semibold">@c.CourseName</div>
                <small class="text-muted">
                    @c.CreditHours Credit Hours
                </small>
            </td>

            <!-- DAY + TIME -->
            <td>
                <div>@c.day_of_week</div>
                <small class="text-muted">
                    @c.StartTime
                    -
                    @c.EndTime
                </small>
            </td>

            <!-- LECTURER -->
            <td>
                @(string.IsNullOrEmpty(c.StaffName) ? "-" : c.StaffName)
            </td>
            
            <!-- ACTIONS -->
            <td>
                @if (User.IsInRole("ADMIN") || User.IsInRole("STAFF"))
                {
                    <button class="btn btn-sm btn-outline-info"
                            data-course='@Html.Raw(System.Text.Json.JsonSerializer.Serialize(c))'
                            onclick="viewCourse(this)">
                        View
                    </button>

                    <button class="btn btn-sm btn-outline-warning"
                        data-course='@Html.Raw(System.Text.Json.JsonSerializer.Serialize(new {
                            c.Id,
                            c.CourseCode,
                            c.CourseName,
                            c.Description,
                            c.CreditHours,
                            c.IsActive,
                            c.StaffId,
                            c.StaffName,
                            c.day_of_week,
                            c.StartTime,
                            c.EndTime
                        }))'
                        onclick="editCourse(this)">
                    Edit
                </button>

                }

                @if (User.IsInRole("ADMIN"))
                {
                    <button class="btn btn-sm btn-outline-danger"
                            onclick="confirmDelete(@c.Id, '@c.CourseName')">
                        Deactivate
                    </button>
                }

                @if (User.IsInRole("STUDENT"))
                {
                    var enrolled = Model.EnrolledCourseIds.Contains(c.Id);

                    if (!enrolled)
                    {
                        <!-- ENROLL -->
                        <form method="post"
                            asp-page-handler="Enroll"
                            asp-route-courseId="@c.Id"
                            class="d-inline">
                            <button class="btn btn-sm btn-success">
                                Enroll
                            </button>
                        </form>
                    }
                    else
                    {
                        <!-- UNENROLL -->
                        <form method="post"
                            asp-page-handler="Unenroll"
                            asp-route-courseId="@c.Id"
                            class="d-inline"
                            onsubmit="return confirm('Are you sure you want to unenroll from this course?');">
                            <button class="btn btn-sm btn-outline-danger">
                                Unenroll
                            </button>
                        </form>
                    }
                }

            </td>
        </tr>
    }
    </tbody>
</table>


<!-- PAGINATION -->
<nav>
    <ul class="pagination justify-content-center">
        @for (int i = 1; i <= Model.TotalPages; i++)
        {
            <li class="page-item @(i==Model.CurrentPage?"active":"")">
                <a class="page-link"
                   href="?pageIndex=@i&search=@Model.Search&status=@Model.Status">
                    @i
                </a>
            </li>
        }
    </ul>
</nav>

<!--View Modal -->
<div class="modal fade" id="viewModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered">
        <div class="modal-content shadow-sm rounded-4">

            <!-- HEADER -->
            <div class="modal-header bg-light rounded-top-4">
                <div>
                    <h5 class="modal-title fw-semibold">Course Details</h5>
                    <small class="text-muted">
                        View course information and schedule
                    </small>
                </div>
                <button class="btn-close" data-bs-dismiss="modal"></button>
            </div>

            <!-- BODY -->
            <div class="modal-body">
                <div class="row g-3">

                    <!-- COURSE INFO -->
                    <div class="col-12">
                        <h6 class="fw-semibold text-primary mb-1">
                            Course Information
                        </h6>
                        <hr class="mt-1 mb-3" />
                    </div>

                    <div class="col-md-8">
                        <h5 id="vName" class="mb-0"></h5>
                        <small id="vCode" class="text-muted"></small>
                    </div>

                    <div class="col-md-4 text-md-end">
                        <span id="vStatus"
                              class="badge rounded-pill px-3 py-2">
                        </span>
                    </div>

                    <div class="col-12">
                        <label class="form-label text-muted">Description</label>
                        <p id="vDescription" class="mb-0"></p>
                    </div>

                    <div class="col-md-4">
                        <label class="form-label text-muted">Credit Hours</label>
                        <div id="vCredit" class="fw-semibold"></div>
                    </div>

                    <!-- SCHEDULE -->
                    <div class="col-12 mt-3">
                        <h6 class="fw-semibold text-primary mb-1">
                            Schedule & Lecturer
                        </h6>
                        <hr class="mt-1 mb-3" />
                    </div>

                    <div class="col-md-6">
                        <label class="form-label text-muted">Lecturer</label>
                        <div id="vLecturer" class="fw-semibold"></div>
                    </div>

                    <div class="col-md-6">
                        <label class="form-label text-muted">Day</label>
                        <div id="vDay" class="fw-semibold"></div>
                    </div>

                    <div class="col-md-6">
                        <label class="form-label text-muted">Start Time</label>
                        <div id="vStartTime" class="fw-semibold"></div>
                    </div>

                    <div class="col-md-6">
                        <label class="form-label text-muted">End Time</label>
                        <div id="vEndTime" class="fw-semibold"></div>
                    </div>

                </div>
            </div>

            <!-- FOOTER -->
            <div class="modal-footer bg-light rounded-bottom-4">
                <button type="button"
                        class="btn btn-outline-secondary"
                        data-bs-dismiss="modal">
                    Close
                </button>
            </div>

        </div>
    </div>
</div>

<!-- Edit Modal -->
<div class="modal fade" id="editModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered">
        <div class="modal-content shadow-sm rounded-4">

            <form method="post" asp-page-handler="Edit">

                <!-- HEADER -->
                <div class="modal-header bg-light rounded-top-4">
                    <div>
                        <h5 class="modal-title fw-semibold">Edit Course</h5>
                        <small class="text-muted">
                            Update course details and schedule
                        </small>
                    </div>
                    <button class="btn-close" data-bs-dismiss="modal"></button>
                </div>

                <!-- BODY -->
                <div class="modal-body">
                    <input type="hidden" name="id" id="eId" />

                    <div class="row g-3">

                        <!-- COURSE INFO -->
                        <div class="col-12">
                            <h6 class="fw-semibold text-primary mb-1">
                                Course Information
                            </h6>
                            <hr class="mt-1 mb-3" />
                        </div>

                        <div class="col-md-6">
                            <label class="form-label">Course Code</label>
                            <input type="text"
                                   class="form-control"
                                   name="courseCode"
                                   id="eCode"
                                   required />
                        </div>

                        <div class="col-md-6">
                            <label class="form-label">Course Name</label>
                            <input type="text"
                                   class="form-control"
                                   name="courseName"
                                   id="eName"
                                   required />
                        </div>

                        <div class="col-12">
                            <label class="form-label">Description</label>
                            <textarea class="form-control"
                                      name="description"
                                      id="eDescription"
                                      rows="3"></textarea>
                        </div>

                        <div class="col-md-4">
                            <label class="form-label">Credit Hours</label>
                            <input type="number"
                                   class="form-control"
                                   name="creditHours"
                                   id="eCredit"
                                   min="1"
                                   required />
                        </div>

                        <div class="col-md-4">
                            <label class="form-label">Status</label>
                            <select class="form-select"
                                    name="isActive"
                                    id="eStatus">
                                <option value="true">Active</option>
                                <option value="false">Inactive</option>
                            </select>
                        </div>

                        <div class="col-md-4 d-flex align-items-end">
                            <span class="badge bg-warning-subtle text-warning border">
                                Editing existing course
                            </span>
                        </div>

                        <!-- SCHEDULE -->
                        <div class="col-12 mt-3">
                            <h6 class="fw-semibold text-primary mb-1">
                                Schedule & Lecturer
                            </h6>
                            <hr class="mt-1 mb-3" />
                        </div>

                        
                        <!-- Lecturer -->
                        <div class="col-md-6">
                            <label class="form-label">
                                Lecturer <span class="text-danger">*</span>
                            </label>
                            <select class="form-select"
                                    name="staffId"
                                    id="eStaffId"
                                    required>
                                <option value="">-- Select Lecturer --</option>
                                @foreach (var staff in Model.StaffList)
                                {
                                    <option value="@staff.Id">
                                        @staff.FullName
                                    </option>
                                }
                            </select>
                        </div>

                        <!-- Day -->
                        <div class="col-md-6">
                            <label class="form-label">
                                Day of Week <span class="text-danger">*</span>
                            </label>
                            <select class="form-select"
                                    name="dayOfWeek"
                                    id="eDayOfWeek"
                                    required>
                                <option value="">-- Select Day --</option>
                                <option>Monday</option>
                                <option>Tuesday</option>
                                <option>Wednesday</option>
                                <option>Thursday</option>
                                <option>Friday</option>
                                <option>Saturday</option>
                                <option>Sunday</option>
                            </select>
                        </div>

                        <!-- Start Time -->
                        <div class="col-md-6">
                            <label class="form-label">
                                Start Time <span class="text-danger">*</span>
                            </label>
                            <input type="time"
                                   class="form-control"
                                   name="startTime"
                                   id="eStartTime"
                                   required />
                        </div>

                        <!-- End Time -->
                        <div class="col-md-6">
                            <label class="form-label">
                                End Time <span class="text-danger">*</span>
                            </label>
                            <input type="time"
                                   class="form-control"
                                   name="endTime"
                                   id="eEndTime"
                                   required />
                        </div>

                    </div>
                </div>

                <!-- FOOTER -->
                <div class="modal-footer bg-light rounded-bottom-4">
                    <button type="button"
                            class="btn btn-outline-secondary"
                            data-bs-dismiss="modal">
                        Cancel
                    </button>
                    <button type="submit"
                            id="saveEditBtn"
                            class="btn btn-primary px-4">
                        Save Changes
                    </button>

                </div>

            </form>
        </div>
    </div>
</div>

<!-- Add Modal -->
<div class="modal fade" id="addModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered">
        <div class="modal-content shadow-sm rounded-4">

            <form method="post" asp-page-handler="Add">

                <!-- HEADER -->
                <div class="modal-header bg-light rounded-top-4">
                    <div>
                        <h5 class="modal-title fw-semibold">Add New Course</h5>
                        <small class="text-muted">
                            Enter course details and assign schedule
                        </small>
                    </div>
                    <button class="btn-close" data-bs-dismiss="modal"></button>
                </div>

                <!-- BODY -->
                <div class="modal-body">
                    <div class="row g-3">

                        <!-- COURSE INFO -->
                        <div class="col-12">
                            <h6 class="fw-semibold text-primary mb-1">
                                Course Information
                            </h6>
                            <hr class="mt-1 mb-3" />
                        </div>

                        <div class="col-md-6">
                            <label class="form-label">Course Code</label>
                            <input type="text"
                                id="courseCode"
                                class="form-control"
                                name="courseCode"
                                placeholder="e.g. CS101"
                                required />
                        </div>

                        <div class="col-md-6">
                            <label class="form-label">Course Name</label>
                            <input type="text"
                                id="courseName"
                                class="form-control"
                                name="courseName"
                                placeholder="e.g. Introduction to Programming"
                                required />
                        </div>


                        <div class="col-12">
                            <label class="form-label">Description</label>
                            <textarea class="form-control"
                                      name="description"
                                      rows="3"
                                      placeholder="Brief course description"></textarea>
                        </div>

                        <div class="col-md-4">
                            <label class="form-label">Credit Hours</label>
                            <input type="number"
                                   class="form-control"
                                   name="creditHours"
                                   min="1"
                                   required />
                        </div>

                        <div class="col-md-8 d-flex align-items-end">
                            <span class="badge bg-info-subtle text-info border">
                                Active by default
                            </span>
                        </div>

                        <!-- SCHEDULE -->
                        <div class="col-12 mt-3">
                            <h6 class="fw-semibold text-primary mb-1">
                                Schedule & Lecturer
                            </h6>
                            <hr class="mt-1 mb-3" />
                        </div>

                        <!-- Lecturer -->
                        <div class="col-md-6">
                            <label class="form-label">
                                Lecturer <span class="text-danger">*</span>
                            </label>
                            <select class="form-select" name="staffId" required>
                                <option value="">-- Select Lecturer --</option>
                                @foreach (var staff in Model.StaffList)
                                {
                                    <option value="@staff.Id">
                                        @staff.FullName
                                    </option>
                                }
                            </select>
                        </div>

                        <!-- Day -->
                        <div class="col-md-6">
                            <label class="form-label">
                                Day of Week <span class="text-danger">*</span>
                            </label>
                            <select class="form-select" name="dayOfWeek" required>
                                <option value="">-- Select Day --</option>
                                <option>Monday</option>
                                <option>Tuesday</option>
                                <option>Wednesday</option>
                                <option>Thursday</option>
                                <option>Friday</option>
                                <option>Saturday</option>
                                <option>Sunday</option>
                            </select>
                        </div>

                        <!-- Start Time -->
                        <div class="col-md-6">
                            <label class="form-label">
                                Start Time <span class="text-danger">*</span>
                            </label>
                            <input type="time"
                                   class="form-control"
                                   name="startTime"
                                   required />
                        </div>

                        <!-- End Time -->
                        <div class="col-md-6">
                            <label class="form-label">
                                End Time <span class="text-danger">*</span>
                            </label>
                            <input type="time"
                                   class="form-control"
                                   name="endTime"
                                   required />
                        </div>

                    </div>
                </div>

                <!-- FOOTER -->
                <div class="modal-footer bg-light rounded-bottom-4">
                    <button type="button"
                            class="btn btn-outline-secondary"
                            data-bs-dismiss="modal">
                        Cancel
                    </button>
                    <button type="submit"
                            class="btn btn-success px-4">
                        Add Course
                    </button>
                </div>

            </form>
        </div>
    </div>
</div>

<!-- PENDING REQUESTS MODAL -->
<div class="modal fade" id="pendingModal" tabindex="-1">
    <div class="modal-dialog modal-xl modal-dialog-centered modal-dialog-scrollable">
        <div class="modal-content shadow-sm rounded-4">

            <!-- HEADER -->
            <div class="modal-header bg-success-subtle">
                <h5 class="modal-title fw-semibold text-success">
                    Pending Course Requests
                </h5>
                <button class="btn-close" data-bs-dismiss="modal"></button>
            </div>

            <!-- BODY -->
            <div class="modal-body">

                @if (!Model.PendingApprovals.Any())
                {
                    <div class="text-center text-muted py-5">
                        No pending requests.
                    </div>
                }
                else
                {
                    <div class="accordion" id="pendingAccordion">

                        @foreach (var p in Model.PendingApprovals)
                        {
                            <div class="accordion-item mb-2">

                                <!-- SUMMARY LINE -->
                                <h2 class="accordion-header" id="heading-@p.Id">
                                    <button class="accordion-button collapsed"
                                            type="button"
                                            data-bs-toggle="collapse"
                                            data-bs-target="#collapse-@p.Id"
                                            aria-expanded="false"
                                            aria-controls="collapse-@p.Id">

                                        <div class="w-100 d-flex justify-content-between align-items-center">
                                            <div>
                                                <strong>@p.StaffName</strong>
                                                → <strong>@p.CourseCode</strong>
                                                (@p.CourseName)
                                            </div>

                                            <small class="text-muted">
                                                @p.CreatedAt.ToString("yyyy-MM-dd HH:mm")
                                            </small>
                                        </div>
                                    </button>
                                </h2>

                                <!-- DETAILS PANEL -->
                                <div id="collapse-@p.Id"
                                     class="accordion-collapse collapse"
                                     aria-labelledby="heading-@p.Id"
                                     data-bs-parent="#pendingAccordion">

                                    <div class="accordion-body">

                                        @{
                                            var payload = System.Text.Json.JsonSerializer
                                                .Deserialize<CourseFlow.Models.Course>(p.PayloadJson);
                                        }

                                        <!-- REQUEST META -->
                                        <div class="mb-3">
                                            <span class="badge bg-warning text-dark">
                                                @p.ActionType
                                            </span>
                                        </div>

                                        <!-- EDITABLE ADMIN FORM -->
                                        <form method="post" asp-page-handler="Approve">

                                            <input type="hidden"
                                                   name="approvalId"
                                                   value="@p.Id" />

                                            <div class="row g-3">

                                                <div class="col-md-6">
                                                    <label class="form-label">Course Code</label>
                                                    <input class="form-control"
                                                           name="CourseCode"
                                                           value="@(payload?.CourseCode ?? "")" />
                                                </div>

                                                <div class="col-md-6">
                                                    <label class="form-label">Course Name</label>
                                                    <input class="form-control"
                                                           name="CourseName"
                                                           value="@(payload?.CourseName ?? "")"
 />
                                                </div>

                                                <div class="col-12">
                                                    <label class="form-label">Description</label>
                                                    <textarea class="form-control"
                                                              name="Description"
                                                              rows="3">@(payload?.Description ?? "")</textarea>
                                                </div>

                                                <div class="col-md-4">
                                                    <label class="form-label">Credit Hours</label>
                                                    <input type="number"
                                                           class="form-control"
                                                           name="CreditHours"
                                                           value="@(payload?.CreditHours ?? 0)" required/>
                                                </div>
                                            </div>

                                            <!-- ACTION BUTTONS -->
                                            <div class="d-flex justify-content-end gap-2 mt-4">
                                                <button type="submit"
                                                        name="decision"
                                                        value="REJECT"
                                                        class="btn btn-danger">
                                                    Reject
                                                </button>

                                                <button type="submit"
                                                        name="decision"
                                                        value="APPROVE"
                                                        class="btn btn-success">
                                                    Approve
                                                </button>
                                            </div>

                                        </form>

                                    </div>
                                </div>
                            </div>
                        }
                    </div>
                }

            </div>

            <!-- FOOTER -->
            <div class="modal-footer">
                <button class="btn btn-secondary"
                        data-bs-dismiss="modal">
                    Close
                </button>
            </div>

        </div>
    </div>
</div>

<!-- Message Toast -->
<div class="toast-container position-fixed top-0 end-0 p-3">

    <!-- SUCCESS -->
    <div id="successToast"
         class="toast align-items-center text-bg-success border-0"
         role="alert" aria-live="assertive" aria-atomic="true">
        <div class="d-flex">
            <div class="toast-body"></div>
            <button class="btn-close btn-close-white me-2 m-auto"
                    data-bs-dismiss="toast"></button>
        </div>
    </div>

    <!-- ERROR -->
    <div id="errorToast"
         class="toast align-items-center text-bg-danger border-0"
         role="alert" aria-live="assertive" aria-atomic="true">
        <div class="d-flex">
            <div class="toast-body"></div>
            <button class="btn-close btn-close-white me-2 m-auto"
                    data-bs-dismiss="toast"></button>
        </div>
    </div>

</div>


<script>
window.editSaved = false;

document.addEventListener("DOMContentLoaded", function () {

    // -------------------------
    // Save button → mark saved
    // -------------------------
    const saveBtn = document.getElementById("saveEditBtn");
    if (saveBtn) {
        saveBtn.addEventListener("click", function () {
            window.editSaved = true;
        });
    }

    // -------------------------
    // Uppercase inputs
    // -------------------------
    ["eName", "eCode", "courseName", "courseCode"].forEach(id => {
        const el = document.getElementById(id);
        if (el) {
            el.addEventListener("input", function () {
                this.value = String(this.value || "").toUpperCase();
            });
        }
    });

    const message = @Html.Raw(
        TempData["ToastMessage"] != null
            ? System.Text.Json.JsonSerializer.Serialize(TempData["ToastMessage"])
            : "null"
    );


    if (!message) return;

    const isError = message.startsWith("Error:");
    const toastId = isError ? "errorToast" : "successToast";

    const toastEl = document.getElementById(toastId);
    if (!toastEl) return;

    toastEl.querySelector(".toast-body").textContent = message;

    new bootstrap.Toast(toastEl, {
        delay: isError ? 5000 : 3000
    }).show();

});

function viewCourse(btn) {
    const c = JSON.parse(btn.getAttribute('data-course'));

    document.getElementById('vName').innerText = c.CourseName;
    document.getElementById('vCode').innerText = c.CourseCode;
    document.getElementById('vDescription').innerText = c.Description || '-';
    document.getElementById('vCredit').innerText = c.CreditHours;
    document.getElementById('vStatus').innerText = c.IsActive ? 'Active' : 'Inactive';

    document.getElementById("vLecturer").innerText = c.StaffName;
    document.getElementById("vDay").innerText = c.day_of_week;
    document.getElementById("vStartTime").innerText = c.StartTime;
    document.getElementById("vEndTime").innerText = c.EndTime;

    new bootstrap.Modal(document.getElementById('viewModal')).show();
}

function editCourse(btn) {
    const c = JSON.parse(btn.getAttribute('data-course'));

    document.getElementById("eId").value = c.Id;
    document.getElementById("eCode").value = c.CourseCode;
    document.getElementById("eName").value = c.CourseName;
    document.getElementById("eDescription").value = c.Description;
    document.getElementById("eCredit").value = c.CreditHours;
    console.log(c.IsActive);
    document.getElementById("eStatus").value = c.IsActive ? "true" : "false";
    document.getElementById("eStaffId").value = c.StaffId ?? "";
    document.getElementById("eDayOfWeek").value = c.day_of_week;
    document.getElementById("eStartTime").value = c.StartTime;
    document.getElementById("eEndTime").value = c.EndTime;

    new bootstrap.Modal(document.getElementById('editModal')).show();
}

function confirmDelete(id, name) {
    if (!confirm(`Deactivate course "${name}"?`)) return;

    const token = document.querySelector(
        'input[name="__RequestVerificationToken"]'
    ).value;

    const form = document.createElement('form');
    form.method = 'post';
    form.action = '?handler=Delete';

    const idInput = document.createElement('input');
    idInput.type = 'hidden';
    idInput.name = 'id';
    idInput.value = id;

    const tokenInput = document.createElement('input');
    tokenInput.type = 'hidden';
    tokenInput.name = '__RequestVerificationToken';
    tokenInput.value = token;

    form.appendChild(idInput);
    form.appendChild(tokenInput);

    document.body.appendChild(form);
    form.submit();
}

function openPendingModal(pendingList) {
    const empty = document.getElementById('pendingEmpty');
    const wrapper = document.getElementById('pendingTableWrapper');
    const tbody = document.getElementById('pendingTableBody');

    tbody.innerHTML = '';

    if (!pendingList || pendingList.length === 0) {
        empty.classList.remove('d-none');
        wrapper.classList.add('d-none');
        return;
    }

    empty.classList.add('d-none');
    wrapper.classList.remove('d-none');

    pendingList.forEach(p => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
            <td>${p.id}</td>
            <td><span class="badge bg-warning text-dark">${p.action}</span></td>
            <td>
                <div class="fw-semibold">${p.courseName}</div>
                <small class="text-muted">${p.courseCode}</small>
            </td>
            <td>${p.requestedBy}</td>
            <td>${p.createdAt}</td>
            <td>
                <form method="post" action="?handler=Approve" class="d-inline">
                    <input type="hidden" name="approvalId" value="${p.id}" />
                    <input type="hidden" name="decision" value="APPROVE" />
                    <button class="btn btn-sm btn-success">Approve</button>
                </form>

                <form method="post" action="?handler=Approve" class="d-inline">
                    <input type="hidden" name="approvalId" value="${p.id}" />
                    <input type="hidden" name="decision" value="REJECT" />
                    <button class="btn btn-sm btn-danger">Reject</button>
                </form>
            </td>
        `;

        tbody.appendChild(tr);
    });
}

setTimeout(() => {
    const alert = document.querySelector('.alert');
    if (alert) {
        bootstrap.Alert.getOrCreateInstance(alert).close();
    }
}, 3000);
</script>
